import React, { useEffect, useRef } from 'react';

const WhaleLoader = () => {
  const radarAnimRef = useRef({ value: 0 });
  const floatAnimRef = useRef({ value: 0 });
  const blinkAnimRef = useRef({ value: 1 });

  useEffect(() => {
    let animationFrameId;
    let startTime = null;
   
    // Radar animation
    const animateRadar = (timestamp) => {
      if (!startTime) startTime = timestamp;
      const progress = timestamp - startTime;
      const rotation = (progress / 2000) * 360; // 2000ms for full rotation
     
      radarAnimRef.current.value = rotation % 360;
     
      const radarElement = document.querySelector('.loaderSpan');
      if (radarElement) {
        radarElement.style.transform = `rotate(${radarAnimRef.current.value}deg)`;
      }
     
      animationFrameId = requestAnimationFrame(animateRadar);
    };
   
    // Float animation
    const animateFloat = (timestamp) => {
      if (!startTime) startTime = timestamp;
      const progress = timestamp - startTime;
      const cycleTime = 3000; // 3000ms for full cycle
      const cycleProgress = (progress % cycleTime) / cycleTime;
     
      if (cycleProgress < 0.5) {
        // First half of cycle: move up
        floatAnimRef.current.value = -10 * (cycleProgress * 2);
      } else {
        // Second half of cycle: move down
        floatAnimRef.current.value = -10 * (2 - cycleProgress * 2);
      }
     
      const whaleElement = document.querySelector('.whaleSvg');
      if (whaleElement) {
        const containerElement = document.querySelector('.loader');
        const scaleFactor = containerElement ? Math.min(containerElement.offsetWidth / 235, 1) : 1;
        const baseScale = 0.6 * scaleFactor;
        const translateX = -67 * scaleFactor;
        const translateY = -67 * scaleFactor;
        whaleElement.style.transform = `scale(${baseScale}) translateX(${translateX}px) translateY(${translateY}px) translateY(${floatAnimRef.current.value * scaleFactor}px)`;
      }
     
      animationFrameId = requestAnimationFrame(animateFloat);
    };
   
    // Blink animation
    const animateBlink = (timestamp) => {
      if (!startTime) startTime = timestamp;
      const progress = timestamp - startTime;
      const cycleTime = 1500; // 1500ms for full cycle
      const cycleProgress = (progress % cycleTime) / cycleTime;
     
      if (cycleProgress < 0.5) {
        // First half of cycle: fade out
        blinkAnimRef.current.value = 1 - (cycleProgress * 2) * 0.5;
      } else {
        // Second half of cycle: fade in
        blinkAnimRef.current.value = 0.5 + ((cycleProgress - 0.5) * 2) * 0.5;
      }
     
      const pathElements = document.querySelectorAll('.blinkElement');
      pathElements.forEach(el => {
        el.style.opacity = blinkAnimRef.current.value;
      });
     
      animationFrameId = requestAnimationFrame(animateBlink);
    };
   
    // Start all animations
    const startTimeRadar = performance.now();
    const startTimeFloat = performance.now();
    const startTimeBlink = performance.now();
   
    const animateAll = (timestamp) => {
      animateRadar(timestamp - startTimeRadar);
      animateFloat(timestamp - startTimeFloat);
      animateBlink(timestamp - startTimeBlink);
      animationFrameId = requestAnimationFrame(animateAll);
    };
   
    animationFrameId = requestAnimationFrame(animateAll);
   
    // Clean up
    return () => {
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }
    };
  }, []);

  return (
    <div className="loader" style={styles.loader}>
      <div
        className="loaderSpan"
        style={styles.loaderSpan}
      >
        <div style={styles.loaderSpanBefore} />
      </div>
      <div style={styles.loaderBefore} />
      <div style={styles.loaderAfter} />
      <div style={styles.container}>
        <div
          className="whaleSvg"
          style={styles.whaleSvg}
        >
          <svg style={{ width: '100%', height: '100%' }} viewBox="0 0 512 512">
            <path
              className="blinkElement"
              d="M0 0 C1.17369141 -0.02513672 1.17369141 -0.02513672 2.37109375 -0.05078125 C4.5625 0.3125 4.5625 0.3125 6.21875 1.4296875 C16.28489569 15.53399628 14.80403073 43.11043504 12.24267578 59.33886719 C9.42764192 74.30955734 2.50691761 87.77343119 -8.4375 98.3125 C-7.03963759 102.83661628 -5.2022604 107.00885638 -3.125 111.25 C12.43808791 144.03569885 15.36921379 181.88167852 3.66918945 216.31665039 C-1.72616101 231.18307465 -9.28170589 245.17382589 -19.4375 257.3125 C-20.29884455 258.37445898 -21.15949377 259.43698221 -22.01953125 260.5 C-31.41555015 271.98025142 -41.69560286 282.22396663 -53.4375 291.3125 C-53.99856445 291.75529297 -54.55962891 292.19808594 -55.13769531 292.65429688 C-66.33641177 301.47532799 -78.15101629 309.09647589 -90.4375 316.3125 C-91.15486328 316.73660156 -91.87222656 317.16070312 -92.61132812 317.59765625 C-117.0098197 331.82815278 -145.94565204 341.1672634 -173.4375 347.3125 C-161.50831108 363.10113239 -141.09181947 374.94660433 -124.14941406 384.66015625 C-123.07191895 385.29244141 -123.07191895 385.29244141 -121.97265625 385.9375 C-121.337229 386.30101562 -120.70180176 386.66453125 -120.04711914 387.0390625 C-118.0562305 388.61413836 -117.31893592 389.94191451 -116.4375 392.3125 C-116.65498616 398.51085548 -116.65498616 398.51085548 -119.09521484 401.01074219 C-127.07002993 405.44285747 -141.0302117 401.98304613 -149.8125 401.0625 C-151.11687012 400.92682617 -152.42124023 400.79115234 -153.76513672 400.65136719 C-194.80566305 396.2688541 -245.15082239 388.52263874 -273.4375 355.3125 C-276.77256341 350.85271241 -279.65595704 346.13134647 -282.4375 341.3125 C-282.99308594 340.35730469 -283.54867187 339.40210938 -284.12109375 338.41796875 C-290.58364254 326.41609242 -295.52217643 311.98923787 -295.4375 298.3125 C-296.30624756 298.32821045 -297.17499512 298.3439209 -298.07006836 298.36010742 C-345.72452393 299.10387469 -391.93062405 290.60563972 -434.4375 268.3125 C-432.71696593 269.78921016 -430.9957676 271.26513064 -429.2734375 272.73974609 C-427.87826968 273.93491512 -426.48546177 275.13283961 -425.09375 276.33203125 C-396.70564938 299.93735405 -357.82156127 312.2931878 -321.390625 314.73046875 C-320.30894043 314.80692627 -319.22725586 314.88338379 -318.11279297 314.9621582 C-315.94629657 315.11008513 -313.77853486 315.24070373 -311.60986328 315.35229492 C-310.61196777 315.41908447 -309.61407227 315.48587402 -308.5859375 315.5546875 C-307.24281494 315.62985596 -307.24281494 315.62985596 -305.87255859 315.70654297 C-302.73641953 316.48696177 -301.46552331 317.84474816 -299.4375 320.3125 C-298.72867697 323.22034881 -299.09778211 325.255039 -299.4375 328.3125 C-300.92639179 330.29040031 -301.90241559 331.15757185 -304.28833008 331.84838867 C-310.63694995 332.43490195 -316.77897786 332.17019091 -323.125 331.625 C-324.2171582 331.53250977 -325.30931641 331.44001953 -326.43457031 331.34472656 C-356.29055848 328.60540724 -383.94603596 320.27348805 -410.4375 306.3125 C-411.60023438 305.70792969 -412.76296875 305.10335938 -413.9609375 304.48046875 C-428.00577348 296.84740572 -440.28524301 286.79444342 -451.80078125 275.7734375 C-453.93917321 273.77760501 -456.05456506 271.99923305 -458.4375 270.3125 C-452.82030605 281.11692985 -446.69360023 290.35780667 -438.4375 299.3125 C-437.86773437 299.96347656 -437.29796875 300.61445313 -436.7109375 301.28515625 C-415.88199478 323.87654797 -383.65663853 334.40320156 -354.4375 340.3125 C-353.68194824 340.46702637 -352.92639648 340.62155273 -352.14794922 340.78076172 C-343.26021548 342.5230319 -334.38725903 343.36822076 -325.3515625 343.83203125 C-324.54552078 343.87357834 -323.73947906 343.91512543 -322.90901184 343.95793152 C-318.8272795 344.16234049 -314.7460138 344.34250812 -310.66186523 344.4909668 C-309.14045956 344.5564155 -307.61905645 344.62192402 -306.09765625 344.6875 C-305.39947784 344.70621658 -304.70129944 344.72493317 -303.98196411 344.74421692 C-299.68713378 344.94221536 -296.87269308 345.69796992 -293.4375 348.3125 C-292.01087781 351.16574437 -292.12716132 353.14704549 -292.4375 356.3125 C-293.73828125 358.98046875 -293.73828125 358.98046875 -296.4375 361.3125 C-300.27212771 362.05532517 -304.04505108 361.9213058 -307.9375 361.8125 C-309.08589355 361.79405029 -310.23428711 361.77560059 -311.41748047 361.7565918 C-332.75180064 361.23226152 -353.71772567 358.3764747 -374.4375 353.3125 C-375.59765625 353.03067871 -375.59765625 353.03067871 -376.78125 352.74316406 C-415.59319068 343.02285213 -449.34193326 319.94019304 -470.05395508 285.52124023 C-479.02781906 270.01460429 -487.78396507 249.51064021 -485.4375 231.3125 C-483.31986005 224.45863306 -479.12072568 220.00795412 -473.0990839 216.20304966 C-467.31099215 213.40015186 -461.41371409 213.76399062 -455.10215759 213.81370544 C-453.75045517 213.80997443 -452.39875666 213.80448169 -451.0470677 213.79738861 C-447.34688119 213.78298264 -443.64711774 213.79328064 -439.9469465 213.80767167 C-435.94999598 213.81881126 -431.95310733 213.80678361 -427.9561615 213.79748535 C-421.03073696 213.78440314 -414.10543318 213.78555405 -407.18000603 213.79607964 C-397.14203924 213.81104992 -387.10421337 213.80107979 -377.06625456 213.78456045 C-360.74623298 213.75810082 -344.42624304 213.7472402 -328.10620117 213.74829102 C-327.12985545 213.74834934 -326.15350973 213.74840766 -325.14757777 213.74846775 C-321.19307551 213.74873353 -317.23857325 213.74905078 -313.28407099 213.74943101 C-302.43083531 213.75039502 -291.57760059 213.74907263 -280.72436523 213.74633789 C-279.26846151 213.74597805 -279.26846151 213.74597805 -277.7831456 213.74561094 C-261.54109756 213.74118882 -245.29907871 213.72489028 -229.0570479 213.7011171 C-219.05908101 213.68711703 -209.06122591 213.68410278 -199.06325532 213.69573999 C-192.19411482 213.70311947 -185.32503021 213.69992398 -178.455895 213.68878155 C-174.50568933 213.68276855 -170.55564073 213.68145408 -166.60544586 213.69365883 C-125.8468958 213.81138534 -86.78633698 208.88610951 -56.23046875 179.265625 C-44.76268485 167.54948415 -37.48891939 152.79349162 -37.1875 136.375 C-37.26420885 130.48759605 -37.96758358 125.00842612 -39.4375 119.3125 C-40.45070313 119.58964844 -41.46390625 119.86679688 -42.5078125 120.15234375 C-43.85933394 120.51838081 -45.21089876 120.88425772 -46.5625 121.25 C-47.22765625 121.43240234 -47.8928125 121.61480469 -48.578125 121.80273438 C-66.14638362 126.53927469 -83.83399777 125.34887729 -100.1875 117.25 C-120.08520527 105.67583976 -132.32780545 85.36238397 -140 64.1875 C-140.25160889 63.50147705 -140.50321777 62.8154541 -140.76245117 62.10864258 C-142.25707343 57.72473975 -142.79707645 53.92991827 -142.4375 49.3125 C-140.31110068 45.8571011 -138.72777439 45.39257569 -134.8125 44.3125 C-131.34053851 44.4415692 -130.43693954 45.31308003 -127.9765625 47.859375 C-126.67237836 49.46258688 -125.41295804 51.09454908 -124.15649414 52.73535156 C-120.77636803 57.10007507 -117.83490418 59.9291317 -112.4375 61.3125 C-108.50090172 61.74194708 -105.33375291 61.31141152 -101.5625 60.3125 C-90.58677574 57.68583095 -78.33715558 58.96035853 -67.4375 61.3125 C-66.85355469 60.07886719 -66.85355469 60.07886719 -66.2578125 58.8203125 C-59.78791616 45.910335 -52.32091894 38.13386475 -38.4375 33.3125 C-28.22486213 29.39146212 -17.38548595 25.06443045 -11.4375 15.3125 C-9.98837794 11.94731654 -8.71117971 8.56859224 -7.515625 5.10546875 C-5.83999307 0.76461068 -4.4661184 0.02200058 0 0 Z M-7.625 35.375 C-15.17818827 42.03957788 -24.41214237 45.72875726 -33.875 48.8125 C-43.23514547 52.08228296 -46.80134149 56.58502182 -51.1875 65.3125 C-52.90201141 68.90175753 -54.51633361 72.50502991 -56.015625 76.1875 C-57.4375 79.3125 -57.4375 79.3125 -59.4375 80.3125 C-65.0550155 80.89765786 -68.87991147 79.57059457 -74.0078125 77.28515625 C-82.48311258 73.89231104 -92.47084921 74.51923136 -101.16015625 76.80078125 C-105.51876612 77.78016014 -109.98933236 77.99655538 -114.4375 78.3125 C-110.37129184 89.5289486 -100.8117008 98.24335142 -90.4375 103.6875 C-75.82673547 110.45923973 -61.42615248 109.35367783 -46.4375 104.3125 C-45.19347893 103.78243179 -43.95378466 103.24208775 -42.71875 102.69140625 C-38.55518652 100.94171826 -36.6992006 100.76279069 -32.4375 102.3125 C-22.57824412 112.54914366 -21.01888852 127.21986339 -21.234375 140.6796875 C-21.94223473 161.906847 -34.71872649 180.83510205 -49.4375 195.3125 C-83.02254189 225.98401302 -126.07457848 229.61224744 -169.1507411 229.62917423 C-173.11227494 229.63291864 -177.07376863 229.64809802 -181.03527832 229.66178894 C-187.8753745 229.68390969 -194.7154561 229.69901353 -201.55558014 229.70915604 C-211.4448723 229.72383028 -221.3341136 229.74939069 -231.22337565 229.77748732 C-247.27357802 229.82279776 -263.32378778 229.85947712 -279.37402344 229.890625 C-294.9521616 229.92087542 -310.53028177 229.95525517 -326.10839844 229.99511719 C-327.07093053 229.99757874 -328.03346263 230.00004028 -329.02516237 230.00257643 C-333.85458894 230.01495229 -338.6840153 230.02740858 -343.51344156 230.03990483 C-383.4881027 230.14323645 -423.46278572 230.23251699 -463.4375 230.3125 C-459.30092826 234.5001676 -459.30092826 234.5001676 -454.6015625 238.00390625 C-453.5182666 238.69939575 -453.5182666 238.69939575 -452.41308594 239.40893555 C-451.63739258 239.89273682 -450.86169922 240.37653809 -450.0625 240.875 C-449.23524414 241.39167236 -448.40798828 241.90834473 -447.55566406 242.44067383 C-403.25478987 269.66948373 -354.83433145 282.44035034 -303.1015625 282.76879883 C-300.24709599 282.79033036 -297.39329906 282.82966093 -294.5390625 282.87109375 C-293.23142441 282.87126747 -293.23142441 282.87126747 -291.89736938 282.8714447 C-290.68867691 282.89145287 -290.68867691 282.89145287 -289.45556641 282.91186523 C-288.39663681 282.91947121 -288.39663681 282.91947121 -287.3163147 282.92723083 C-284.87459794 283.42792852 -283.9973765 284.40934612 -282.4375 286.3125 C-281.14050171 288.90649657 -280.96762605 291.48163783 -280.58886719 294.32958984 C-277.8248413 314.58185443 -271.15899551 332.83815876 -257.4375 348.3125 C-256.60798828 349.26576172 -256.60798828 349.26576172 -255.76171875 350.23828125 C-238.18839133 369.15372437 -206.98609957 375.44470223 -182.75 380.1875 C-181.71222412 380.39076904 -180.67444824 380.59403809 -179.60522461 380.8034668 C-172.23903576 382.16295285 -164.91200269 382.86592212 -157.4375 383.3125 C-160.44462301 380.24178708 -163.51151565 377.70515449 -167 375.1875 C-172.26322876 371.28976177 -177.10870515 367.12292969 -181.90625 362.65625 C-184.12232777 360.60432614 -186.38255634 358.63783694 -188.6875 356.6875 C-191.89010822 353.89813155 -194.64939206 350.91089952 -197.39453125 347.67578125 C-200.49191149 344.09276969 -203.73119076 340.64377125 -206.95507812 337.17480469 C-209.92237255 333.97481779 -212.8289887 330.73578227 -215.6875 327.4375 C-218.73007402 323.99260214 -221.94615036 320.94276727 -225.4609375 317.984375 C-226.74258305 316.90029537 -228.00009398 315.78675716 -229.2265625 314.640625 C-237.3483345 307.10638544 -247.11797433 301.37538982 -256.86328125 296.1875 C-258.4375 295.3125 -258.4375 295.3125 -259.4375 294.3125 C-260.02440745 287.03484763 -260.02440745 287.03484763 -257.8125 284.3125 C-254.29027384 282.82945741 -251.23096032 282.66398248 -247.58349609 283.98291016 C-245.48827357 284.95817329 -243.46413496 286.01411921 -241.4375 287.125 C-240.69129395 287.52952393 -239.94508789 287.93404785 -239.17626953 288.35083008 C-222.5127596 297.66529577 -205.9383669 312.09683917 -194.7890625 327.60546875 C-194.21929687 328.35441406 -193.64953125 329.10335938 -193.0625 329.875 C-192.58039063 330.55691406 -192.09828125 331.23882812 -191.6015625 331.94140625 C-187.38493641 334.61295094 -182.20956723 332.70373364 -177.60107422 331.6862793 C-174.57543182 330.95886091 -171.56927273 330.1766779 -168.5625 329.375 C-167.53125 329.11009766 -166.5 328.84519531 -165.4375 328.57226562 C-159.66229944 327.09374511 -159.66229944 327.09374511 -154.4375 324.3125 C-164.94801656 320.55053915 -174.90221539 317.87997768 -186.078125 316.89453125 C-186.89047607 316.81807373 -187.70282715 316.74161621 -188.53979492 316.6628418 C-190.15301624 316.51507924 -191.76791534 316.38441829 -193.3840332 316.27270508 C-198.94846636 315.77102861 -198.94846636 315.77102861 -201.44140625 313.43359375 C-202.8045025 310.53100056 -202.84170115 308.47874236 -202.4375 305.3125 C-201.375 303.5 -201.375 303.5 -199.4375 302.3125 C-180.17292303 298.47911776 -156.44736858 305.31225353 -139.6875 314.640625 C-135.91911048 316.57917153 -133.21617918 317.75183501 -129.01586914 316.71435547 C-128.17660889 316.37291504 -127.33734863 316.03147461 -126.47265625 315.6796875 C-125.51883057 315.29248535 -124.56500488 314.9052832 -123.58227539 314.50634766 C-122.56512451 314.07112793 -121.54797363 313.6359082 -120.5 313.1875 C-119.43966553 312.73810059 -118.37933105 312.28870117 -117.28686523 311.82568359 C-90.48152427 300.12236381 -66.51158394 282.43677573 -45.4375 262.3125 C-44.8791748 261.77971436 -44.32084961 261.24692871 -43.74560547 260.69799805 C-21.46533813 238.96812649 -5.71115927 208.01771009 -5.19555664 176.55297852 C-5.11509721 151.68126165 -10.95196727 126.70319744 -24.56494141 105.56152344 C-27.26019584 101.29887489 -28.35934626 98.32253403 -27.4375 93.3125 C-25.43983894 91.09254283 -23.68271759 89.44643619 -21.375 87.625 C-9.39622785 77.33988458 -3.97278236 64.24478774 -2.76513672 48.56713867 C-2.41998809 43.01409416 -2.31248407 37.80876103 -3.4375 32.3125 C-5.23782532 32.3125 -6.39429718 34.18103458 -7.625 35.375 Z"
              fill="#E0E0E0"
              transform="translate(492.4375,53.6875)"
              style={{ opacity: 1 }}
            />
            <ellipse
              className="blinkElement"
              cx={420}
              cy={120}
              rx={3}
              ry={3}
              fill="#123881"
              transform="translate(492.4375,53.6875)"
              style={{ opacity: 1 }}
            />
          </svg>
        </div>
      </div>
    </div>
  );
};

const styles = {
  loader: {
    position: 'relative',
    width: 'min(235px, calc(100vw - 60px))',
    height: 'min(235px, calc(100vw - 60px))',
    maxWidth: '235px',
    maxHeight: '235px',
    backgroundColor: 'transparent',
    borderRadius: '50%',
    border: '1px solid #333',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    margin: '10px auto',
    overflow: 'hidden',
    marginBottom: '30px',
    boxSizing: 'border-box',
  },
  loaderBefore: {
    position: 'absolute',
    top: 'min(25px, 10.6%)',
    left: 'min(25px, 10.6%)',
    right: 'min(25px, 10.6%)',
    bottom: 'min(25px, 10.6%)',
    backgroundColor: 'transparent',
    border: '1px dashed #444',
    borderRadius: '50%',
    boxShadow: 'inset -3.33px -3.33px 16.67px rgba(0, 0, 0, 0.25)',
  },
  loaderAfter: {
    position: 'absolute',
    width: 'min(125px, 53.2%)',
    height: 'min(125px, 53.2%)',
    borderRadius: '50%',
    border: '1px dashed #444',
    boxShadow: 'inset -3.33px -3.33px 16.67px rgba(0, 0, 0, 0.25)',
  },
  loaderSpan: {
    position: 'absolute',
    top: '50%',
    left: '50%',
    width: '50%',
    height: '100%',
    backgroundColor: 'transparent',
    transformOrigin: 'top left',
    borderTop: '1px dashed rgba(255, 255, 255, 0.45)',
    zIndex: 1,
  },
  loaderSpanBefore: {
    position: 'absolute',
    top: 0,
    left: 0,
    width: '100%',
    height: '100%',
    backgroundColor: 'rgba(46, 139, 87, 0.7)',
    transform: 'rotate(-55deg)',
    transformOrigin: 'top left',
    filter: 'blur(30px)',
    boxShadow: '20px 20px 20px rgba(46, 139, 87, 0.7)',
  },
  container: {
    position: 'absolute',
    width: 'min(167.5px, 71.3%)',
    height: 'min(167.5px, 71.3%)',
    top: 'min(33px, 14%)',
    left: 'min(33px, 14%)',
    zIndex: 2,
  },
  whaleSvg: {
    position: 'absolute',
    width: '100%',
    height: '100%',
    top: '20%',
    left: '20%',
    zIndex: 3,
  },
};

export default WhaleLoader;